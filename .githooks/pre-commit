#!/bin/bash
# Pre-commit hook for quick MATLAB quality checks
#
# This hook runs before each commit to catch basic quality issues early.
# It uses Python static analysis for speed (no MATLAB startup overhead).
#
# Installation:
#   cp .githooks/pre-commit .git/hooks/pre-commit
#   chmod +x .git/hooks/pre-commit
#
# OR configure git to use .githooks directory:
#   git config core.hooksPath .githooks

set -e  # Exit on error

echo ""
echo "Running pre-commit quality checks..."

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# Run Python static analyzer (fast, no MATLAB needed)
PYTHON_EXIT_CODE=0
python matlab_utilities/scripts/matlab_quality_check.py || PYTHON_EXIT_CODE=$?

if [ $PYTHON_EXIT_CODE -ne 0 ]; then
    echo ""
    echo -e "${RED}❌ Quality checks failed!${NC}"
    echo "Please fix the issues before committing."
    echo ""
    echo "To commit anyway (NOT recommended):"
    echo "  git commit --no-verify"
    echo ""
    exit 1
fi

echo -e "${GREEN}✅ Quality checks passed!${NC}"
echo ""
exit 0
